<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Authentification TransFlow - Corrig√©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #1976d2;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #1565c0;
        }
        button.danger {
            background-color: #dc3545;
        }
        button.danger:hover {
            background-color: #c82333;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .debug-info {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .debug-info h4 {
            margin-top: 0;
            color: #495057;
        }
        .debug-info pre {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Test Authentification TransFlow - Corrig√©</h1>
        <p>Cette page teste le syst√®me d'authentification corrig√© avec persistance de session.</p>
        
        <div class="form-group">
            <label for="password">Mot de passe:</label>
            <input type="password" id="password" placeholder="Saisissez le mot de passe">
        </div>
        
        <div>
            <button onclick="testAuth()">Tester l'authentification</button>
            <button onclick="checkLocalStorage()" class="danger">V√©rifier LocalStorage</button>
            <button onclick="clearLocalStorage()" class="danger">Nettoyer LocalStorage</button>
            <button onclick="simulatePageReload()">Simuler rechargement</button>
        </div>
        
        <div id="status"></div>
        
        <div class="debug-info">
            <h4>üîç Informations de d√©bogage</h4>
            <div id="debug-content">
                <p>Cliquez sur "V√©rifier LocalStorage" pour voir les informations de session.</p>
            </div>
        </div>
        
        <div class="info" style="margin-top: 30px; padding: 15px;">
            <h3>üìã Instructions de test</h3>
            <ol>
                <li><strong>Saisir le mot de passe</strong> : TransFlow2024!</li>
                <li><strong>Tester l'authentification</strong> : V√©rifier la connexion</li>
                <li><strong>V√©rifier LocalStorage</strong> : Voir les donn√©es de session</li>
                <li><strong>Simuler rechargement</strong> : Tester la persistance</li>
                <li><strong>Acc√©der √† l'app</strong> : <a href="http://localhost:3002" target="_blank">http://localhost:3002</a></li>
            </ol>
            
            <h3>‚ö†Ô∏è Probl√®mes connus et solutions</h3>
            <ul>
                <li><strong>Redirection vers login</strong> : Ajout d'un √©tat de chargement</li>
                <li><strong>Session perdue</strong> : V√©rification du timestamp de session</li>
                <li><strong>LocalStorage bloqu√©</strong> : Gestion des erreurs</li>
                <li><strong>√âtat asynchrone</strong> : Gestion de l'initialisation</li>
            </ul>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            password: 'TransFlow2024!',
            storageKey: 'transflow_auth',
            timestampKey: 'transflow_auth_timestamp',
            appUrl: 'http://localhost:3002'
        };

        // Test de l'authentification
        function testAuth() {
            const password = document.getElementById('password').value;
            const statusDiv = document.getElementById('status');
            
            if (password === CONFIG.password) {
                // Sauvegarder l'authentification
                try {
                    localStorage.setItem(CONFIG.storageKey, 'true');
                    localStorage.setItem(CONFIG.timestampKey, Date.now().toString());
                    
                    statusDiv.innerHTML = `
                        <div class="status success">
                            <h3>‚úÖ Authentification r√©ussie!</h3>
                            <p>Le mot de passe est correct et la session a √©t√© sauvegard√©e.</p>
                            <p><strong>Session sauvegard√©e dans LocalStorage</strong></p>
                            <p><a href="${CONFIG.appUrl}" target="_blank">Acc√©der √† TransFlow</a></p>
                        </div>
                    `;
                    
                    // Mettre √† jour les informations de d√©bogage
                    checkLocalStorage();
                } catch (error) {
                    statusDiv.innerHTML = `
                        <div class="status error">
                            <h3>‚ùå Erreur de sauvegarde</h3>
                            <p>Impossible de sauvegarder la session: ${error.message}</p>
                        </div>
                    `;
                }
            } else {
                statusDiv.innerHTML = `
                    <div class="status error">
                        <h3>‚ùå Authentification √©chou√©e</h3>
                        <p>Le mot de passe saisi est incorrect.</p>
                        <p><strong>Mot de passe attendu:</strong> ${CONFIG.password}</p>
                    </div>
                `;
            }
        }

        // V√©rifier le contenu du LocalStorage
        function checkLocalStorage() {
            const debugDiv = document.getElementById('debug-content');
            
            try {
                const authStatus = localStorage.getItem(CONFIG.storageKey);
                const timestamp = localStorage.getItem(CONFIG.timestampKey);
                const sessionAge = timestamp ? Math.floor((Date.now() - parseInt(timestamp)) / 1000) : null;
                
                let debugInfo = `
                    <h4>üìä √âtat du LocalStorage</h4>
                    <pre>Cl√© d'authentification: ${CONFIG.storageKey}
Valeur: ${authStatus || 'Non d√©finie'}
Timestamp: ${timestamp || 'Non d√©fini'}
√Çge de la session: ${sessionAge ? sessionAge + ' secondes' : 'N/A'}
LocalStorage disponible: ${typeof localStorage !== 'undefined' ? 'Oui' : 'Non'}</pre>
                `;
                
                if (authStatus === 'true' && timestamp) {
                    debugInfo += `
                        <div class="status success">
                            <strong>‚úÖ Session active trouv√©e</strong><br>
                            La session est valide et peut √™tre utilis√©e pour acc√©der √† l'application.
                        </div>
                    `;
                } else {
                    debugInfo += `
                        <div class="status warning">
                            <strong>‚ö†Ô∏è Aucune session active</strong><br>
                            Vous devez vous authentifier pour acc√©der √† l'application.
                        </div>
                    `;
                }
                
                debugDiv.innerHTML = debugInfo;
            } catch (error) {
                debugDiv.innerHTML = `
                    <div class="status error">
                        <h4>‚ùå Erreur d'acc√®s au LocalStorage</h4>
                        <p>Erreur: ${error.message}</p>
                        <p>Le LocalStorage peut √™tre d√©sactiv√© ou bloqu√© par le navigateur.</p>
                    </div>
                `;
            }
        }

        // Nettoyer le LocalStorage
        function clearLocalStorage() {
            try {
                localStorage.removeItem(CONFIG.storageKey);
                localStorage.removeItem(CONFIG.timestampKey);
                
                document.getElementById('status').innerHTML = `
                    <div class="status info">
                        <h3>üßπ LocalStorage nettoy√©</h3>
                        <p>Toutes les donn√©es de session ont √©t√© supprim√©es.</p>
                    </div>
                `;
                
                checkLocalStorage();
            } catch (error) {
                document.getElementById('status').innerHTML = `
                    <div class="status error">
                        <h3>‚ùå Erreur lors du nettoyage</h3>
                        <p>Erreur: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Simuler un rechargement de page
        function simulatePageReload() {
            document.getElementById('status').innerHTML = `
                <div class="status info">
                    <h3>üîÑ Simulation de rechargement</h3>
                    <p>V√©rifiez que la session persiste apr√®s rechargement de la page.</p>
                    <p><strong>Conseil:</strong> Rechargez la page (F5) pour tester la persistance.</p>
                </div>
            `;
        }

        // Permettre l'utilisation de la touche Entr√©e
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testAuth();
            }
        });

        // V√©rifier le LocalStorage au chargement de la page
        window.addEventListener('load', function() {
            checkLocalStorage();
        });
    </script>
</body>
</html>




